# 2021---对2020年的总结和思考

## 自我介绍：

你好，我叫mozihao，广东，现担任广州某中型公司的前端工程师一职，主要负责C端的前端开发工作，负责过峰会saas项目的的pc和h5端的功能迭代和维护，优化代码以及移动端的适配工作，也负责过以文旅主题的微信小程序项目，旅游攻略周边等功能，页面样式的多样化以及通过数据采集埋点技术的实现，更精准客户运营。

在公司主要的技术栈是vue和小程序原生开发，在这年期间也在不断的沉淀积累知识，更巩固基础和输出在业务上遇到的难点都一一进行了记录在我的github上，这年也在试着运营公众号和在学习新知识node.js。同样将node.js的学习笔记输出在我的公众号。职业规划上，我想往node,js方向发展，探索热点serverless方向



做什么： 峰会pc和h5端，文旅小程序

擅长什么： vue和小程序原生开发

前端思考：可视化，前端智能化，serverless

职业规划： 一年中级，三年高级，想走node方向--serverless



## 项目难点：

### **埋点**：

使用了灯塔这个第三方插件实现，其实主要的难点是如果监听页面的变化，然后对埋点数据的上传，首先我们先和后端协定好埋点参数，例如个点击事件的参数（资源类型的点击，导航栏点击，各标签类型的点击），页面停留市场，对应资源类型，id等等，页面的监听，之前是想着怎么去监听路由的变化，但是想了想原生小程序里面好像没有监听路由的方法，上网找了找资源还是没能找到更多相关的资料，后来决定重写跳转的方法。遍历所有的跳转方法使用Object.definePrototype重写原生各个页面跳转的方法，在各跳转方法在跳转之后执行一个回调函数，然后记录对应的页面的路由返回对应的资源类型，通过灯塔的api，上传对应的埋点参数。通过监听路由的变化，重写路由跳转方法实现埋点参数的上传

### **分享功能**：

**微信小程序端分享功能**： 小程序的分享海报，通过canvas生成海报图，但是canvas绘制的图片是需要通过调用微信的原生方法进行图片的读取获取到对应图片的本地图，然后需要生成一个带太阳码的图片，此时需要拼url将传入id和页面的路径进行拼接然后生成一个太阳码的图片，用户可以通过分享的海报的形式，通过扫太阳码入到小程序对应的页面，还有一传入封面图的取中自适应（使用到绘制图片的6个参数），二进制图片转本地图片等等

**pc和h5分享功能**：主要是使用第三方插件，html2Canvas实现，但是在使用这个插件也是碰到过不少的坑，例如截图不全，白边，截图偏移，生成图片模糊，还有跨域，还有css的文本省略生效等，生成的图片是base64格式的，所以在pc端的下载是没有兼容问题的，但是在h5的下载是会出现兼容的问题，下载base64的图片在移动端浏览器是无法下载识别出图片的，后面将base64转成blod流的形式，进行下载，但是还是有部分安卓和ios不兼容，所以，此处我们需要对这个文件通过调用接口上传，拿接口返回的网络图通过a标签的download属性来进行下载

### **下载功能**：

下载功能，在h5端开始使用的实现方案方向不太对，导致后面为自己埋了坑，下载功能实现文件下载，图片，压缩包下载等等，使用过的下载方式有iframe和a标签。因为有一个批量下载的功能，所以通过自测这两个下载方式，我通过模拟批量下载的方式遍历这两个下载的方法，但是发现a标签只能弹出最后一个，iframe就可以实现多个，但是后面发现iframe在ios使用时不兼容的，而且不能下载图片。考虑到兼容的问题，我们最后决定使用接口返回流的形式进行下载。批量下载就使用一个压缩包的形式，设置axios的responseType 改为blod，如果文件名为中文名需要使用decodeURI()方法进行解码，然后使用a标签实现下载

### **移动端适配**：

px单位转rem，使用第三方插件，postcss-pxtorem和amfe-flexible配置根元素字体大小，一般默认设计尺寸为750，在postcssrc.js文件中配置根字体大小为37.5。但这里需要注意的是行内样式是无法转换的。使用百分比和flex布局



### 换肤：

使用css3的变量，定义肤色，协商好肤色字段，再协定好的字段定义类名，然后在全局里面引入这些换肤的类，然后在各页面的最外层应用换肤类名，然后在写css的使用使用对应的变量，在页面初始化的时候，就把拿到的换肤字段存储在vuex



### 国际化：





## 业务的思考：

例如：比如我们在一个功能上，我们后续可能会做什么业务的功能的扩展，需要在我们的代码设计上后续新增相关联的业务进行的代码的扩展性，或者说优化我们的交互。提高我们的用户体验，其实我们程序员自己本身也是一个用户，如果自己都接受不来的交互，怎么叫别人接受，所谓子所不欲，勿施于人。还有哪些需要抽取我们的组件，提高我们代码的复用率